<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>EnerXL — PV</title>
  <!-- Leave this external -->
  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <style>
    :root{--slate:#0F172A;--border:#e5e7eb;--bg:#f8fafc}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:var(--slate)}
    header{display:flex;align-items:center;gap:.6rem;padding:12px 14px;border-bottom:1px solid var(--border);background:#fff}
    .dot{width:20px;height:20px;border-radius:5px;background:#22C55E;display:inline-block}
    h1{font-size:16px;margin:0}
    main{padding:14px}
    button{padding:8px 12px;border-radius:10px;border:1px solid var(--border);background:#fff;cursor:pointer}
    .row{display:flex;gap:8px;align-items:center;margin:.5rem 0}
    input{padding:6px 8px;border:1px solid var(--border);border-radius:8px}
  </style>
</head>
<body>
  <header>
    <span class="dot" title="PV"></span>
    <h1>EnerXL — PV</h1>
  </header>

  <main>
    <p>Task pane is running. Single-file HTML+JS.</p>

    <div class="row">
      <button id="write">Write “EnerXL ready” → A1</button>
      <button id="read">Read A1 → alert</button>
    </div>

    <div class="row">
      <input id="coordLat" placeholder="Lat (to B1)" size="12"/>
      <input id="coordLng" placeholder="Lng (to C1)" size="12"/>
      <button id="pushLatLng">Push</button>
    </div>
  </main>

  <script>
    /* global Office, Excel */
    Office.onReady(() => {
      const $ = (id) => document.getElementById(id);

      $('write').addEventListener('click', async () => {
        try {
          await Excel.run(async (ctx) => {
            const ws = ctx.workbook.worksheets.getActiveWorksheet();
            ws.getRange('A1').values = [['EnerXL ready']];
            await ctx.sync();
          });
        } catch (e) { console.error(e); alert('Excel error: ' + e); }
      });

      $('read').addEventListener('click', async () => {
        try {
          await Excel.run(async (ctx) => {
            const ws = ctx.workbook.worksheets.getActiveWorksheet();
            const r = ws.getRange('A1'); r.load('values');
            await ctx.sync();
            alert('A1 = ' + (r.values?.[0]?.[0] ?? ''));
          });
        } catch (e) { console.error(e); alert('Excel error: ' + e); }
      });

      $('pushLatLng').addEventListener('click', async () => {
        const lat = parseFloat($('coordLat').value);
        const lng = parseFloat($('coordLng').value);
        if (!Number.isFinite(lat) || !Number.isFinite(lng)) { alert('Enter valid numbers'); return; }
        try {
          await Excel.run(async (ctx) => {
            const ws = ctx.workbook.worksheets.getActiveWorksheet();
            ws.getRange('B1').values = [[lat]];
            ws.getRange('C1').values = [[lng]];
            await ctx.sync();
          });
        } catch (e) { console.error(e); alert('Excel error: ' + e); }
      });
    });
  </script>
</body>
</html>
