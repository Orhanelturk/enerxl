<script>
(function(){
  const repo = "Orhanelturk/enerxl";           // <-- your repo
  const key  = "enerxl_last_sha";              // localStorage key
  const qs   = new URLSearchParams(location.search);
  const cur  = qs.get("v") || "";              // current query version

  async function latestSHA() {
    // GitHub API allows CORS and no auth up to ~60 req/h per IP
    const r = await fetch(`https://api.github.com/repos/${repo}/commits/main?cachebust=${Date.now()}`, {cache:"no-store"});
    if (!r.ok) throw new Error("GitHub API " + r.status);
    const j = await r.json();
    return (j && (j.sha || (j[0] && j[0].sha))) || "";
  }

  async function ensureLatest(trigger) {
    try {
      const sha = (await latestSHA()).slice(0, 10);
      const last = localStorage.getItem(key) || "";
      if (sha && sha !== cur) {
        localStorage.setItem(key, sha);
        const url = new URL(location.href);
        url.searchParams.set("v", sha);
        location.replace(url.toString());      // reload with new cache-busting tag
      } else if (!trigger) {
        // first load and already up-to-date â€” continue
      }
    } catch (e) {
      // optional: fallback to version.json if API blocked
    }
  }

  // On first load:
  ensureLatest(false);
  // Re-check when the pane regains focus (e.g., after you push)
  window.addEventListener("focus", () => ensureLatest(true));
})();
</script>
